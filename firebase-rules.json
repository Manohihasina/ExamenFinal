{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",
    "cars": {
      "$carId": {
        ".read": "auth != null && (data.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".write": "auth != null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".validate": {
          "id": "newData.hasChild('id')",
          "userId": "newData.hasChild('userId') && newData.child('userId').val() === auth.uid",
          "brand": "newData.hasChild('brand') && newData.child('brand').isString() && newData.child('brand').val().length > 0",
          "model": "newData.hasChild('model') && newData.child('model').isString() && newData.child('model').val().length > 0",
          "licensePlate": "newData.hasChild('licensePlate') && newData.child('licensePlate').isString() && newData.child('licensePlate').val().length > 0",
          "make": "newData.hasChild('make') && newData.child('make').isString() && newData.child('make').val().length > 0",
          "createdAt": "newData.hasChild('createdAt') && newData.child('createdAt').isNumber()",
          "updatedAt": "newData.hasChild('updatedAt') && newData.child('updatedAt').isNumber()",
          "status": "newData.hasChild('status') && (newData.child('status').val() === 'active' || newData.child('status').val() === 'inactive')",
          "year": "!newData.hasChild('year') || (newData.child('year').isNumber() && newData.child('year').val() >= 1900 && newData.child('year').val() <= 2100)",
          "color": "!newData.hasChild('color') || newData.child('color').isString()"
        }
      }
    },
    "repairs": {
      "$repairId": {
        ".read": "auth != null && (data.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".write": "auth != null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".validate": {
          "id": "newData.hasChild('id')",
          "userId": "newData.hasChild('userId') && newData.child('userId').val() === auth.uid",
          "carId": "newData.hasChild('carId') && newData.child('carId').isString() && newData.child('carId').val().length > 0",
          "interventionId": "newData.hasChild('interventionId') && newData.child('interventionId').isNumber()",
          "interventionName": "newData.hasChild('interventionName') && newData.child('interventionName').isString() && newData.child('interventionName').val().length > 0",
          "interventionDuration": "newData.hasChild('interventionDuration') && newData.child('interventionDuration').isNumber() && newData.child('interventionDuration').val() > 0",
          "interventionPrice": "newData.hasChild('interventionPrice') && newData.child('interventionPrice').isNumber() && newData.child('interventionPrice').val() >= 0",
          "status": "newData.hasChild('status') && (newData.child('status').val() === 'pending' || newData.child('status').val() === 'in_progress' || newData.child('status').val() === 'halfway' || newData.child('status').val() === 'completed')",
          "halfwayNotified": "newData.hasChild('halfwayNotified') && newData.child('halfwayNotified').isBoolean()",
          "completedNotified": "newData.hasChild('completedNotified') && newData.child('completedNotified').isBoolean()",
          "startedAt": "!newData.hasChild('startedAt') || newData.child('startedAt').isNumber()",
          "estimatedCompletion": "!newData.hasChild('estimatedCompletion') || newData.child('estimatedCompletion').isNumber()"
        }
      }
    },
    "repair_slots": {
      "$slotId": {
        ".read": "auth != null",
        ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() === 'admin'",
        ".validate": {
          "id": "newData.hasChild('id') && newData.child('id').isNumber()",
          "slot_number": "newData.hasChild('slot_number') && newData.child('slot_number').isNumber() && newData.child('slot_number').val() > 0",
          "status": "newData.hasChild('status') && (newData.child('status').val() === 'available' || newData.child('status').val() === 'occupied' || newData.child('status').val() === 'waiting_payment')",
          "car_id": "!newData.hasChild('car_id') || (newData.child('car_id').isNumber() && newData.child('car_id').val() >= 0)",
          "created_at": "newData.hasChild('created_at') && newData.child('created_at').isString()",
          "updated_at": "newData.hasChild('updated_at') && newData.child('updated_at').isString()"
        }
      }
    },
    "users": {
      "$userId": {
        ".read": "auth != null && ($userId === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".write": "auth != null && ($userId === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
        ".validate": {
          "email": "newData.hasChild('email') && newData.child('email').isString() && newData.child('email').val().contains('@')",
          "name": "newData.hasChild('name') && newData.child('name').isString() && newData.child('name').val().length > 0",
          "role": "newData.hasChild('role') && (newData.child('role').val() === 'client' || newData.child('role').val() === 'admin' || newData.child('role').val() === 'mechanic')"
        }
      }
    }
  }
}
